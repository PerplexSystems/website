<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ config.title | default(value="Perplex Systems") }}{% endblock %}</title>

    <meta property="og:title" content="{% block og_title %}{{ config.title | default(value="Perplex Systems") }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ config.extra.tagline | default(value="Software Craftsmanship & Research") }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ config.base_url | safe }}{% endblock %}">
    <meta property="og:site_name" content="{{ config.extra.site_name | default(value="Perplex Systems") }}">
    {% if config.extra.logo %}
    <meta property="og:image" content="{{ config.base_url | safe }}{{ config.extra.logo }}">
    {% endif %}

    <link href="{{ config.base_url | safe }}/base.css" rel="stylesheet" />
    {% block extra_head %}{% endblock %}
</head>
<body>
    <div class="container">
        <div class="header-top">
            {% block header_top %}
            <a href="/">Portal</a> | 
            <a href="/sitemap.xml">Site Map</a> | 
            <!-- TODO: add contact page -->
            Contact Us
            {% endblock %}
        </div>

        <header>
            <div class="header-main">
                <div class="logo-section">
                    <div class="logo">
                        {% if config.extra.logo %}
                        <img src="{{ config.extra.logo }}" alt="Logo">
                        {% else %}
                        PS
                        {% endif %}
                    </div>
                    <div>
                        <h1>{{ config.extra.site_name | default(value="PERPLEX SYSTEMS") }}</h1>
                        <div class="header-subtitle">{{ config.extra.tagline | default(value="Software Craftsmanship & Research") }}</div>
                    </div>
                </div>
                <div style="text-align: right; font-size: 10px;">
                    <div>{{ "1996-01-23" | date(format="%A, %B %d, %Y") }}</div>
                    {% if config.extra.version %}
                    <div style="margin-top: 3px;">Version {{ config.extra.version }}</div>
                    {% endif %}
                </div>
            </div>
        </header>

        <nav class="nav-bar">
            <ul>
                {% block navigation %}
                <li><a href="{{ config.base_url | safe }}" {% if current_path == "/" %}class="active"{% endif %}>Home</a></li>
                <li><a href="{{ config.base_url | safe }}/projects" {% if current_path == "/projects/" %}class="active"{% endif %}>Projects</a></li>
                <li><a href="{{ config.base_url | safe }}/blog" {% if current_path == "/blog/" %}class="active"{% endif %}>Blog</a></li>
                {% endblock %}
            </ul>
        </nav>

        <div class="breadcrumb">
            {% block breadcrumb %}
            <a href="{{ config.base_url | safe }}">Home</a> &gt; <span>{% block breadcrumb_current %}Portal{% endblock %}</span>
            {% endblock %}
        </div>

        <div class="main-content">
            {% block sidebar %}
            <aside class="sidebar">

                {% set quick_links = page.extra.quick_links | default(value=section.extra.quick_links | default(value=false)) %}
                {% if quick_links %}
                <div class="sidebar-section">
                    <input type="checkbox" id="quick-links-toggle" class="sidebar-toggle" checked>
                    <label for="quick-links-toggle" class="sidebar-label">Quick Links</label>
                    <h3>Quick Links</h3>
                    <div class="sidebar-content">
                        <ul>
                        {% for link in quick_links %}
                        <li><a href="#{{ link.anchor }}">{{ link.title }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                {% set is_project_page = current_path is starting_with("/projects/") and current_path != "/projects/" %}
                {% set toc = section.toc | default(value=page.toc | default(value=[])) %}
                {% if is_project_page and toc %}
                <div class="sidebar-section">
                    <input type="checkbox" id="toc-toggle" class="sidebar-toggle" checked>
                    <label for="toc-toggle" class="sidebar-label">Contents</label>
                    <h3>Contents</h3>
                    <div class="sidebar-content">
                        <ul class="toc">
                        {% for h1 in toc %}
                            <li class="toc-item{% if h1.children %} toc-has-children{% endif %}">
                            {% if h1.children %}
                            <input type="checkbox" id="toc-{{ h1.id }}" class="toc-item-toggle" checked>
                            <label for="toc-{{ h1.id }}" class="toc-item-label"><a href="#{{ h1.id }}">{{ h1.title }}</a></label>
                            <ul class="toc-nested">
                            {% for h2 in h1.children %}
                                <li class="toc-item{% if h2.children %} toc-has-children{% endif %}">
                                {% if h2.children %}
                                <input type="checkbox" id="toc-{{ h2.id }}" class="toc-item-toggle">
                                <label for="toc-{{ h2.id }}" class="toc-item-label"><a href="#{{ h2.id }}">{{ h2.title }}</a></label>
                                <ul class="toc-nested">
                                {% for h3 in h2.children %}
                                    <li class="toc-item{% if h3.children %} toc-has-children{% endif %}">
                                    {% if h3.children %}
                                    <input type="checkbox" id="toc-{{ h3.id }}" class="toc-item-toggle">
                                    <label for="toc-{{ h3.id }}" class="toc-item-label"><a href="#{{ h3.id }}">{{ h3.title }}</a></label>
                                    <ul class="toc-nested">
                                    {% for h4 in h3.children %}
                                        <li class="toc-item{% if h4.children %} toc-has-children{% endif %}">
                                        {% if h4.children %}
                                        <input type="checkbox" id="toc-{{ h4.id }}" class="toc-item-toggle">
                                        <label for="toc-{{ h4.id }}" class="toc-item-label"><a href="#{{ h4.id }}">{{ h4.title }}</a></label>
                                        <ul class="toc-nested">
                                        {% for h5 in h4.children %}
                                            <li class="toc-item"><a href="#{{ h5.id }}">{{ h5.title }}</a></li>
                                        {% endfor %}
                                        </ul>
                                        {% else %}
                                        <a href="#{{ h4.id }}">{{ h4.title }}</a>
                                        {% endif %}
                                        </li>
                                    {% endfor %}
                                    </ul>
                                    {% else %}
                                    <a href="#{{ h3.id }}">{{ h3.title }}</a>
                                    {% endif %}
                                    </li>
                                {% endfor %}
                                </ul>
                                {% else %}
                                <a href="#{{ h2.id }}">{{ h2.title }}</a>
                                {% endif %}
                                </li>
                            {% endfor %}
                            </ul>
                            {% else %}
                            <a href="#{{ h1.id }}">{{ h1.title }}</a>
                            {% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <div class="sidebar-section">
                    <input type="checkbox" id="projects-toggle" class="sidebar-toggle" checked>
                    <label for="projects-toggle" class="sidebar-label">Projects</label>
                    <h3>Projects</h3>
                    <div class="sidebar-content">
                        <ul>
                        {% set projects = get_section(path="projects/_index.md") %}
                        {% for path in projects.subsections %}
                            {% set project = get_section(path=path) %}
                            <li><a href="{{ project.permalink }}">{{ project.title }}</a></li>
                        {% endfor %}
                        </ul>
                    </div>
                </div>
            </aside>
            {% endblock %}

            <main class="content">
                {% block content %}{% endblock %}
            </main>

            {% block right_sidebar %}
            <aside class="right-sidebar">
                <div class="news-section">
                    <h3 style="color: #003366; font-size: 11px; margin-bottom: 12px; text-transform: uppercase; border-bottom: 2px solid #336699; padding-bottom: 5px;">Latest Updates</h3>
                    <div class="news-content">
                        {% block news_items %}
                        {% set blog = get_section(path="blog/_index.md") %}
                        {% for post in blog.pages | slice(end=5) %}
                        <div class="news-item">
                            <div class="news-date">{{ post.date | date(format="%B %d, %Y") }}</div>
                            <div class="news-title"><a href="{{ post.permalink }}">{{ post.title }}</a></div>
                            {% if post.description %}
                            <p style="font-size: 10px; margin-top: 5px; color: #666;">{{ post.description }}</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                        {% endblock %}
                    </div>
                </div>
            </aside>
            {% endblock %}
        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h4>About</h4>
                    <ul>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#docs">Documentation</a></li>
                        <li><a href="#projects">Projects</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Connect</h4>
                    <ul>
                        {% if config.extra.github %}
                        <li><a href="{{ config.extra.github }}">GitHub</a></li>
                        {% endif %}
                        {% if config.extra.email %}
                        <li><a href="mailto:{{ config.extra.email }}">Email</a></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; {{ now() | date(format="%Y") }} {{ config.extra.site_name | default(value="Perplex Systems") }}. All rights reserved.
            </div>
        </footer>
    </div>
</body>
</html>
